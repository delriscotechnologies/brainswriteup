
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TryHackMe Brains Write-up</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
  body {
    background-color: #d2b48c;
    color: #4b3b2b;
    font-family: 'Share Tech Mono', monospace;
    margin: 2rem;
  }
  h1, h2 {
    color: #3e2c1c;
  }
  pre {
    background-color: #c0a16b;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    overflow-x: auto;
  }
  code {
    font-family: monospace;
    background-color: #b99865;
    padding: 2px 4px;
    border-radius: 4px;
  }
  section {
    margin-bottom: 2.5rem;
    padding: 1rem;
    background-color: #f0e1c6;
    border-left: 5px solid #9c7b4f;
    border-radius: 6px;
    box-shadow: 1px 2px 5px rgba(0,0,0,0.1);
  }
  header {
    margin-bottom: 3rem;
  }
  footer {
    margin-top: 4rem;
    font-size: 0.9rem;
    color: #4b3b2b;
    text-align: center;
  }
  ul {
    line-height: 1.5;
  }
</style>
</head>
<body>
<header>
  <h1>TryHackMe: Brains Write-up</h1>
  <p>The <em>Brains</em> room on TryHackMe revolves around exploiting and analyzing a real-world critical vulnerability in JetBrains TeamCity: <strong>CVE-2024-27198</strong>, which allows <strong>unauthenticated remote code execution</strong>. The scenario is divided into two phases. In the first part, you act as an attacker who is only given an IP address of the target server. In the second part, you shift perspective to the defender, inspecting logs through Splunk to trace and analyze the attack.</p>
  <p>This exercise is not just about exploitation—it demonstrates how offensive and defensive tools can work together to improve cybersecurity awareness.</p>
</header>

<section>
  <h2>Step 1: Scanning the Target</h2>
  <p>We start with the only information we have: the target IP address <code>10.10.164.206</code>. The first task is to enumerate the target by scanning for open ports and services to identify potential attack vectors.</p>
  <p>We run the following command using <code>nmap</code> to quickly map out exposed services:</p>
  <pre>nmap 10.10.164.206</pre>
  <p>The scan reveals three open ports:</p>
  <ul>
    <li><strong>22/tcp (SSH):</strong> Typically used for secure shell access.</li>
    <li><strong>80/tcp (HTTP):</strong> Standard web server port.</li>
    <li><strong>50000/tcp:</strong> A high port running a web service (TeamCity).</li>
  </ul>
  <p>Port scanning is essential because it defines the attack surface. Knowing which services are accessible helps us prioritize next steps.</p>
</section>

<section>
  <h2>Step 2: Exploring Services</h2>
  <p>Next, we manually investigate each open port:</p>
  <ul>
    <li><strong>Port 22 (SSH):</strong> Attempting SSH login fails due to unknown credentials.</li>
    <li><strong>Port 80 (HTTP):</strong> Visiting <code>http://10.10.164.206</code> shows a maintenance page, with no useful information or hidden elements.</li>
    <li><strong>Port 50000:</strong> Navigating to <code>http://10.10.164.206:50000</code> brings up a TeamCity login page. Importantly, the page footer shows the exact TeamCity version: <strong>2023.11.3 (build 147512)</strong>.</li>
  </ul>
  <p>Identifying the software version is critical because it enables us to research known vulnerabilities for that specific version.</p>
</section>

<section>
  <h2>Step 3: Researching Vulnerabilities</h2>
  <p>With the version info, we search databases like CVE.org and the National Vulnerability Database for issues with TeamCity 2023.11.3. We discover the following key vulnerabilities:</p>
  <ul>
    <li><strong>CVE-2024-27198:</strong> A critical authentication bypass vulnerability enabling unauthenticated remote code execution. CVSS score 9.8.</li>
    <li><strong>CVE-2024-27199:</strong> Related flaw with a high CVSS score of 7.3, also involving authentication bypass.</li>
  </ul>
  <p>These findings suggest that exploiting the authentication bypass can give us shell access without credentials.</p>
</section>

<section>
  <h2>Step 4: Exploitation via Metasploit</h2>
  <p>We move to Kali Linux and open <code>msfconsole</code> to search for the exploit:</p>
  <pre>msfconsole</pre>
  <pre>search CVE-2024-27198</pre>
  <p>We select the exploit module (option 0) and use it:</p>
  <pre>use 0</pre>
  <p>To understand what the exploit does and the required parameters, we run:</p>
  <pre>info</pre>
  <p>We then configure the remote host and port:</p>
  <pre>set RHOSTS 10.10.164.206
set RPORT 50000</pre>
  <p>Finally, we launch the exploit:</p>
  <pre>run</pre>
  <p>Successful exploitation provides us a shell as the <code>ubuntu</code> user. From there, we read the flag file:</p>
  <pre>cat /home/ubuntu/flag.txt</pre>
</section>

<section>
  <h2>Step 5: Defensive Log Analysis with Splunk</h2>
  <p>Switching to the defender’s role, we log into a Splunk instance with access to relevant server logs to investigate suspicious activity following the compromise.</p>
  <h3>User Creation</h3>
  <p>First, we search the authentication logs for any user creation events:</p>
  <pre>source="/var/log/auth.log" useradd</pre>
  <p>This reveals a new user was created on July 4, 2024, likely a backdoor account established by the attacker.</p>
  <h3>Malicious Package Installation</h3>
  <p>Next, we query package installation logs for anything unusual around the same date:</p>
  <pre>source="/var/log/dpkg.log" date_month="july" date_mday="4" install</pre>
  <p>A suspicious package appears, indicating persistence or further compromise actions.</p>
  <h3>Plugin Upload in TeamCity</h3>
  <p>Finally, we check TeamCity’s activity logs for evidence of plugin uploads (which can be used by attackers to maintain access):</p>
  <pre>source="/opt/teamcity/TeamCity/logs/teamcity-activities.log" plugin</pre>
  <p>This confirms a plugin was installed shortly after exploitation.</p>
</section>

<section>
  <h2>Final Thoughts</h2>
  <p>The Brains room offers a realistic glimpse into modern cybersecurity operations by combining offensive exploitation with defensive investigation. It emphasizes that effective security requires understanding both perspectives.</p>
  <p>By starting with just an IP address, we performed methodical reconnaissance, identifying open services and versions to pinpoint vulnerabilities. Using Metasploit automates the exploitation, but the real value comes from knowing how to research and configure it correctly.</p>
  <p>Switching to log analysis, we saw how defenders piece together evidence from multiple sources—auth logs, package logs, and application activity—to detect attacker behavior. Each query brings additional context to the incident timeline.</p>
  <p>This hands-on practice reinforces the importance of the cyber kill chain: identifying attack surface (reconnaissance and weaponization), gaining access (exploitation), and detecting and responding (analysis and mitigation).</p>
  <p>Overall, this experience sharpened my skills in offensive tools like Nmap and Metasploit, and defensive platforms like Splunk, while deepening my understanding of attacker methodologies and defender workflows.</p>
</section>

<footer>
  <p>© 2025 Del Risco Technologies</p>
</footer>
</body>
</html>
